{{- /* Chezmoi configuration template */ -}}
{{- /* This template decrypts and includes secrets from external_secrets submodule */ -}}
{{- /* Age public key: age1wuc38w6748e7l0za4v5paccs9muasjuuqrdqq8npqyxl0dfseclsfh386e */ -}}

{{- $secretsEncrypted := joinPath .chezmoi.sourceDir "external_secrets/chezmoi-secrets.toml.age" -}}
{{- $ageKey := joinPath .chezmoi.homeDir ".config/chezmoi/key.txt" -}}
{{- if and (stat $secretsEncrypted) (stat $ageKey) }}
{{/* Decrypt and include secrets - this contains the full config */}}
{{ output "age" "-d" "-i" $ageKey $secretsEncrypted | trim }}
{{- else }}
{{/* Secrets not available - using placeholders */}}
encryption = "age"

[data]
    email = "your-email@example.com"
    name = "Your Name"

[data.machine]
    type = "{{ .chezmoi.os }}"

[data.secrets]
    anthropic_vertex_project_id = "your-project-id"
    google_cloud_project = "your-project-id"

[edit]
    command = "vim"

[git]
    autoCommit = false
    autoPush = false

[age]
    identity = "~/.config/chezmoi/key.txt"
    recipient = "age1wuc38w6748e7l0za4v5paccs9muasjuuqrdqq8npqyxl0dfseclsfh386e"

[diff]
    exclude = ["scripts"]
{{- end }}
